<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>غدير للحسابات | PIN آمن</title>
  <link rel="stylesheet" href="assets/css/theme.css">
  <link rel="manifest" href="manifest.json">
  <script src="assets/js/crypto.js" defer></script>
  <script src="assets/js/app.js" defer></script>
</head>
<body>
  <header>
    <div class="container">
      <div class="brand">
        <div class="logo">GL</div>
        <div>
          <h1>غدير للحسابات — فتح بواسطة PIN</h1>
          <div class="muted">البيانات تُشفّر محليًا. افتحها برمز من 4–8 أرقام.</div>
        </div>
      </div>
      <nav id="tabs" class="hidden">
        <button class="tab active" data-tab="clients">👥 العملاء</button>
        <button class="tab" data-tab="transactions">🧾 فواتير/دفعات</button>
        <button class="tab" data-tab="expenses">🛠️ المصروفات</button>
        <button class="tab" data-tab="summary">📊 ملخص الشركة</button>
        <button class="tab" data-tab="settings">⚙️ إعدادات</button>
      </nav>
    </div>
  </header>

  <main class="container">
    <!-- Gate (PIN) -->
    <div id="gate" class="gate">
      <div class="panel">
        <h2 id="gateTitle">إنشاء PIN</h2>
        <p id="gateDesc" class="muted">أول مرة؟ اختر رمزًا رقميًا من 4 إلى 8 أرقام.</p>

        <div id="newPinFields">
          <label>PIN</label>
          <input id="newPin" inputmode="numeric" pattern="[0-9]*" maxlength="8" placeholder="مثال: 123456" />
          <label>تأكيد PIN</label>
          <input id="newPin2" inputmode="numeric" pattern="[0-9]*" maxlength="8" placeholder="أعد الإدخال" />
        </div>

        <div id="unlockFields" class="hidden">
          <label>أدخل PIN</label>
          <input id="unlockPin" inputmode="numeric" pattern="[0-9]*" maxlength="8" placeholder="••••" />
          <div class="keypad">
            <button data-k="1">1</button><button data-k="2">2</button><button data-k="3">3</button>
            <button data-k="4">4</button><button data-k="5">5</button><button data-k="6">6</button>
            <button data-k="7">7</button><button data-k="8">8</button><button data-k="9">9</button>
            <button data-k="del">⌫</button><button data-k="0">0</button><button data-k="clr">⟲</button>
          </div>
        </div>

        <div class="actions">
          <button class="btn primary" id="gateConfirm">متابعة</button>
          <button class="btn" id="importEnc">⬆️ استيراد نسخة مشفرة</button>
          <button class="btn danger" id="resetAll">مسح كل البيانات</button>
        </div>
        <p class="muted small">
          ⚠️ لا يمكن استرجاع الـ PIN عند فقدانه. للتأمين ضد الاختراق جرّب 6 أرقام أو أكثر.
        </p>
        <input id="filePicker" type="file" accept=".json" class="hidden" />
      </div>
    </div>

    <!-- App Content (same as secure full) -->
    <section id="app" class="hidden">
      <section id="clients" class="tab-pane">
        <div class="grid">
          <div class="card">
            <h2>إضافة عميل</h2>
            <div class="form-grid">
              <div><label>اسم العميل</label><input id="c_name" placeholder="مثال: شركة شمال كردستان" /></div>
              <div><label>الهاتف</label><input id="c_phone" placeholder="07xxxxxxxx" /></div>
              <div><label>المدينة</label><input id="c_city" placeholder="أربيل" /></div>
              <div class="actions" style="align-items:end">
                <button class="btn primary" id="addClientBtn">➕ إضافة</button>
                <button class="btn ghost" id="exportClientsBtn">⬇️ تصدير العملاء</button>
              </div>
            </div>
          </div>
          <div class="card">
            <div class="toolbar">
              <div class="search" style="flex:1"><label>بحث</label><input id="clientSearch" placeholder="ابحث بالاسم أو الهاتف..." /></div>
              <div><label>فرز</label><select id="clientSort">
                <option value="name">حسب الاسم</option>
                <option value="balanceDesc">الرصيد (تنازلي)</option>
                <option value="balanceAsc">الرصيد (تصاعدي)</option>
                <option value="invoices">عدد العمليات</option>
              </select></div>
            </div>
            <div style="margin-top:10px; overflow:auto">
              <table>
                <thead><tr><th>العميل</th><th>الهاتف</th><th>المدينة</th><th>العمليات</th><th>الرصيد</th><th class="right">خيارات</th></tr></thead>
                <tbody id="clientRows"></tbody>
              </table>
            </div>
          </div>
        </div>
      </section>

      <section id="transactions" class="tab-pane hidden">
        <div class="grid">
          <div class="card">
            <h2>إضافة فاتورة / خدمة</h2>
            <div class="form-grid">
              <div><label>العميل</label><select id="t_client"></select></div>
              <div><label>الوصف</label><input id="t_desc" placeholder="وصف الخدمة" /></div>
              <div><label>المبلغ</label><input id="t_amount" type="number" step="0.01" placeholder="0" /></div>
              <div><label>التاريخ</label><input id="t_date" type="date" /></div>
              <div class="actions" style="grid-column:1/-1"><button class="btn primary" id="addInvoiceBtn">🧾 إضافة فاتورة</button></div>
            </div>
          </div>
          <div class="card">
            <h2>تسجيل دفعة مستلمة</h2>
            <div class="form-grid">
              <div><label>العميل</label><select id="p_client"></select></div>
              <div><label>الوصف</label><input id="p_desc" placeholder="مثال: دفعة نقدية" /></div>
              <div><label>المبلغ</label><input id="p_amount" type="number" step="0.01" placeholder="0" /></div>
              <div><label>التاريخ</label><input id="p_date" type="date" /></div>
              <div class="actions" style="grid-column:1/-1"><button class="btn primary" id="addPaymentBtn">💸 تسجيل دفعة</button></div>
            </div>
            <p class="muted">الدفعات تُقلّل رصيد العميل ولا تُحسب مصروفًا على الشركة.</p>
          </div>
        </div>
      </section>

      <section id="expenses" class="tab-pane hidden">
        <div class="grid">
          <div class="card">
            <h2>إضافة مصروف عام</h2>
            <div class="form-grid">
              <div><label>الوصف</label><input id="e_desc" placeholder="وقود، صيانة، رواتب..." /></div>
              <div><label>المبلغ</label><input id="e_amount" type="number" step="0.01" placeholder="0" /></div>
              <div><label>التاريخ</label><input id="e_date" type="date" /></div>
              <div class="actions" style="grid-column:1/-1"><button class="btn primary" id="addExpenseBtn">🛠️ إضافة مصروف</button></div>
            </div>
          </div>
          <div class="card">
            <h2>سجل المصروفات</h2>
            <div style="overflow:auto">
              <table>
                <thead><tr><th>التاريخ</th><th>الوصف</th><th>المبلغ</th><th class="right">خيارات</th></tr></thead>
                <tbody id="expenseRows"></tbody>
              </table>
            </div>
          </div>
        </div>
      </section>

      <section id="summary" class="tab-pane hidden">
        <div class="grid">
          <div class="card">
            <h2>ملخص سريع</h2>
            <div class="stats">
              <div class="stat"><small>إجمالي الفواتير</small><h3 id="s_totalInvoices">-</h3></div>
              <div class="stat"><small>إجمالي الدفعات</small><h3 id="s_totalPayments">-</h3></div>
              <div class="stat"><small>إجمالي المصروفات</small><h3 id="s_totalExpenses">-</h3></div>
              <div class="stat"><small>صافي الربح</small><h3 id="s_netProfit">-</h3></div>
            </div>
            <p class="muted">الربح = مجموع الفواتير − المصروفات.</p>
          </div>
          <div class="card">
            <h2>أفضل العملاء</h2>
            <div style="overflow:auto">
              <table>
                <thead><tr><th>العميل</th><th>عدد الفواتير</th><th>إجمالي فواتيره</th><th>الرصيد</th></tr></thead>
                <tbody id="topClientsRows"></tbody>
              </table>
            </div>
          </div>
        </div>
      </section>

      <section id="settings" class="tab-pane hidden">
        <div class="card">
          <h2>إعدادات ونسخ احتياطي</h2>
          <div class="form-grid">
            <div><label>العملة (رمز)</label><input id="currencyCode" placeholder="USD" /></div>
            <div><label>تنسيق الأرقام</label><select id="localeSelect">
              <option value="en-US">en-US</option>
              <option value="ar">ar</option>
              <option value="ar-SA">ar-SA</option>
            </select></div>
            <div class="actions" style="grid-column:1/-1">
              <button class="btn primary" id="saveSettingsBtn">💾 حفظ الإعدادات</button>
              <button class="btn" id="exportAllBtn">⬇️ تصدير نسخة مشفّرة</button>
              <button class="btn" id="lockBtn">🔒 قفل التطبيق</button>
            </div>
          </div>
        </div>
      </section>
    </section>
  </main>

  <!-- Drawer -->
  <div class="drawer" id="drawer">
    <div class="drawer-panel">
      <div style="display:flex; justify-content:space-between; align-items:center; gap:10px; position:sticky; top:0; background:#0b1224; padding-bottom:10px">
        <div><h2 id="d_title" style="margin:0">كشف حساب</h2><div class="muted" id="d_subtitle"></div></div>
        <div class="actions"><button class="btn" id="d_export">⬇️ تصدير</button><button class="btn" id="d_close">✖️ إغلاق</button></div>
      </div>
      <div class="toolbar" style="margin-top:8px">
        <div class="search" style="flex:1"><label>بحث</label><input id="d_search" placeholder="تصفية حسب الوصف..." /></div>
        <div><label>المدة</label><select id="d_range">
          <option value="all">كل الوقت</option><option value="30">آخر 30 يوم</option><option value="90">آخر 90 يوم</option><option value="365">آخر سنة</option>
        </select></div>
      </div>
      <div style="margin-top:10px; overflow:auto">
        <table>
          <thead><tr><th>التاريخ</th><th>البيان</th><th>النوع</th><th>المبلغ</th><th>الرصيد بعد العملية</th><th class="right">خيارات</th></tr></thead>
          <tbody id="d_rows"></tbody>
        </table>
      </div>
    </div>
  </div>
</body>
</html>
